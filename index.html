<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>种基宝 - 基金资产看板</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- 顶部导航栏 -->
        <header class="top-bar">
            <div class="brand">
                <div class="logo">
                    <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="40" height="40" rx="10" fill="url(#logoGradient)"/>
                        <path d="M10 28L16 20L20 24L30 12" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="30" cy="12" r="2.5" fill="white"/>
                        <defs>
                            <linearGradient id="logoGradient" x1="0" y1="0" x2="40" y2="40" gradientUnits="userSpaceOnUse">
                                <stop stop-color="#667EEA"/>
                                <stop offset="1" stop-color="#764BA2"/>
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <h1>种基宝</h1>
            </div>
            <div class="top-actions">
                <button class="icon-btn" title="添加基金" onclick="showAddModal()" aria-label="添加基金">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                        <line x1="12" y1="8" x2="12" y2="16"/>
                        <line x1="8" y1="12" x2="16" y2="12"/>
                    </svg>
                </button>
                <button class="icon-btn" id="themeToggle" title="切换深色模式" onclick="toggleDarkMode()" aria-label="切换深色模式">
                    <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                    <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                        <circle cx="12" cy="12" r="5"/>
                        <line x1="12" y1="1" x2="12" y2="3"/>
                        <line x1="12" y1="21" x2="12" y2="23"/>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                        <line x1="1" y1="12" x2="3" y2="12"/>
                        <line x1="21" y1="12" x2="23" y2="12"/>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- 资产概览卡片 -->
        <section class="stats-bar">
            <div class="stat-card total">
                <span class="stat-label">总资产</span>
                <span class="stat-value" id="totalAsset">¥ --</span>
            </div>
            <div class="stat-card">
                <span class="stat-label">今日收益</span>
                <span class="stat-value" id="todayProfit">--</span>
            </div>
            <div class="stat-card">
                <span class="stat-label">持有收益</span>
                <span class="stat-value" id="holdProfit">--</span>
            </div>
            <div class="stat-card">
                <span class="stat-label">累计收益率</span>
                <span class="stat-value" id="totalRate">--</span>
            </div>
        </section>

        <!-- 主体布局 -->
        <main class="main-layout">
            <!-- 左侧：基金列表 -->
            <aside class="sidebar">
                <div class="panel-header">
                    <h2>我的持仓</h2>
                    <span class="badge" id="fundCount">0 只</span>
                </div>
                <div class="fund-list-container">
                    <div class="fund-list" id="fundList">
                        <!-- 基金列表由JS生成 -->
                    </div>
                </div>
            </aside>

            <!-- 右侧：主要内容 -->
            <section class="content-area">
                <!-- 市场指数 -->
                <div class="indices-bar">
                    <div class="index-item">
                        <span class="index-name">上证指数</span>
                        <span class="index-value" id="shIndex">--</span>
                    </div>
                    <div class="index-item">
                        <span class="index-name">深证成指</span>
                        <span class="index-value" id="szIndex">--</span>
                    </div>
                    <div class="index-item">
                        <span class="index-name">创业板指</span>
                        <span class="index-value" id="cyIndex">--</span>
                    </div>
                    <div class="index-item">
                        <span class="index-name">沪深300</span>
                        <span class="index-value" id="hs300Index">--</span>
                    </div>
                </div>

                <!-- 主要内容区 -->
                <div class="main-content-grid">
                    <!-- 左侧：图表 -->
                    <div class="chart-panel">
                        <div class="panel-header">
                            <h3 id="chartTitle">收益走势</h3>
                            <div class="period-tabs">
                                <button class="tab-btn active" data-period="day" onclick="switchChartPeriod('day')">日</button>
                                <button class="tab-btn" data-period="month" onclick="switchChartPeriod('month')">月</button>
                                <button class="tab-btn" data-period="year" onclick="switchChartPeriod('year')">年</button>
                                <button class="tab-btn" data-period="all" onclick="switchChartPeriod('all')">全部</button>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <div id="fundChart" style="width: 100%; height: 100%;"></div>
                        </div>
                    </div>

                    <!-- 右侧：新闻 -->
                    <div class="news-panel">
                        <div class="panel-header">
                            <h3>财经快讯</h3>
                            <span class="live-badge">LIVE</span>
                        </div>
                        <div class="news-list-container">
                            <div class="news-list" id="newsList">
                                <!-- 新闻由JS生成 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 行情模块 -->
                <div class="market-panel">
                    <div class="panel-header">
                        <h3>行情</h3>
                        <div class="market-tabs">
                            <button class="tab-btn active" data-tab="self" onclick="switchMarketTab('self')">自选</button>
                            <button class="tab-btn" data-tab="hot" onclick="switchMarketTab('hot')">热门</button>
                            <button class="tab-btn" data-tab="rank" onclick="switchMarketTab('rank')">排行</button>
                        </div>
                    </div>
                    <div class="market-list-container">
                        <div class="market-list" id="marketList">
                            <!-- 行情由JS生成 -->
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- 添加基金弹窗 -->
        <div class="modal" id="addModal" role="dialog" aria-modal="true" aria-labelledby="addModalTitle">
            <div class="modal-overlay" onclick="hideAddModal()"></div>
            <div class="modal-content">
                <h3 id="addModalTitle">添加基金</h3>
                <input type="text" id="fundCode" placeholder="基金代码" maxlength="6" aria-label="基金代码">
                <input type="number" id="fundAmount" placeholder="持仓金额 (元)" step="0.01" aria-label="持仓金额" oninput="calculateAddPreview()">
                <input type="number" id="fundCost" placeholder="成本单价" step="0.0001" aria-label="成本单价" oninput="calculateAddPreview()">
                <input type="number" id="fundShares" placeholder="持有份额 (自动计算)" step="0.01" aria-label="持有份额" readonly style="background: var(--bg-color); cursor: not-allowed;">
                <div class="add-preview" id="addPreview" style="display: none;">
                    <div class="preview-row">
                        <span class="preview-label">预计份额</span>
                        <span class="preview-value" id="previewAddShares">--</span>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" onclick="hideAddModal()">取消</button>
                    <button class="btn-primary" onclick="addFund()">确定</button>
                </div>
            </div>
        </div>

        <!-- 编辑弹窗 -->
        <div class="ios-modal" id="editModal">
            <div class="ios-modal-overlay" onclick="hideEditModal()"></div>
            <div class="ios-modal-content">
                <div class="ios-modal-header">
                    <h3 id="editFundName">基金名称</h3>
                    <span class="ios-fund-code" id="editFundCode">000000</span>
                </div>
                <div class="ios-modal-body">
                    <div class="trade-section">
                        <div class="trade-tabs">
                            <button class="trade-tab active" data-type="buy" onclick="switchTradeType('buy')">加仓</button>
                            <button class="trade-tab" data-type="sell" onclick="switchTradeType('sell')">减仓</button>
                        </div>
                        
                        <div class="trade-notice">
                            <span class="notice-icon">ℹ️</span>
                            <span class="notice-text">此操作仅为模拟记录，并非真实交易</span>
                        </div>
                        
                        <div class="trade-content" id="tradeContent">
                            <div id="buySection">
                                <div class="ios-input-group">
                                    <label>加仓金额</label>
                                    <div class="amount-input-wrapper">
                                        <span class="currency-symbol">¥</span>
                                        <input type="number" id="tradeAmount" step="0.01" placeholder="请输入金额" oninput="calculateTradePreview()">
                                    </div>
                                </div>
                                <div class="fee-info">
                                    <span class="fee-label">估算手续费</span>
                                    <span class="fee-value" id="previewFee">0.00元</span>
                                </div>
                            </div>
                            
                            <div id="sellSection" style="display: none;">
                                <div class="ios-input-group">
                                    <label>卖出份额</label>
                                    <div class="shares-input-wrapper">
                                        <input type="number" id="sellShares" step="0.01" placeholder="请输入份额" oninput="calculateSellPreview()">
                                        <span class="shares-unit">份</span>
                                    </div>
                                    <div class="max-shares-hint">最多可卖 <span id="maxShares">--</span> 份</div>
                                </div>
                                
                                <div class="quick-shares-buttons">
                                    <button class="quick-share-btn" onclick="setSellShares(0.25)">1/4</button>
                                    <button class="quick-share-btn" onclick="setSellShares(0.333)">1/3</button>
                                    <button class="quick-share-btn" onclick="setSellShares(0.5)">1/2</button>
                                    <button class="quick-share-btn all" onclick="setSellShares(1)">全部</button>
                                </div>
                            </div>
                            
                            <div class="trade-preview" id="tradePreview" style="display: none;">
                                <div class="preview-row">
                                    <span class="preview-label" id="previewLabel1">预计份额</span>
                                    <span class="preview-value" id="previewTradeShares">--</span>
                                </div>
                                <div class="preview-row">
                                    <span class="preview-label">持仓成本变化</span>
                                    <span class="preview-value" id="previewCostChange">--</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="current-holding-section">
                        <div class="section-title-small">当前持仓</div>
                        <div class="holding-grid">
                            <div class="holding-item">
                                <span class="holding-label">持有金额</span>
                                <span class="holding-value" id="currentAmount">--</span>
                            </div>
                            <div class="holding-item">
                                <span class="holding-label">持有收益</span>
                                <span class="holding-value" id="currentProfit">--</span>
                            </div>
                            <div class="holding-item">
                                <span class="holding-label">持有份额</span>
                                <span class="holding-value" id="currentShares">--</span>
                            </div>
                            <div class="holding-item">
                                <span class="holding-label">成本单价</span>
                                <span class="holding-value" id="currentCost">--</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ios-modal-actions">
                    <button class="ios-btn-cancel" onclick="hideEditModal()">取消</button>
                    <button class="ios-btn-delete" onclick="deleteCurrentFund()">删除</button>
                    <button class="ios-btn-save" id="tradeConfirmBtn" onclick="confirmTrade()">确认</button>
                </div>
            </div>
        </div>

        <!-- 新闻详情弹窗 -->
        <div class="news-modal" id="newsModal">
            <div class="news-modal-overlay" onclick="closeNewsModal()"></div>
            <div class="news-modal-content">
                <div class="news-modal-header">
                    <span class="news-modal-time" id="newsModalTime">--:--</span>
                    <span class="news-modal-tag" id="newsModalTag">快讯</span>
                </div>
                <div class="news-modal-body">
                    <h4 id="newsModalTitle">新闻标题</h4>
                    <p id="newsModalSummary">新闻摘要内容...</p>
                </div>
                <div class="news-modal-footer">
                    <button class="news-modal-close" onclick="closeNewsModal()">关闭</button>
                </div>
            </div>
        </div>

        <!-- 数据状态 -->
        <div class="data-status" id="dataStatus">
            <span class="status-dot"></span>
            <span class="status-text" id="statusText">数据实时</span>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
